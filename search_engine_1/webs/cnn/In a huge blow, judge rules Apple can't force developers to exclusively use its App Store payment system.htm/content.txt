(CNN Business) Apple can no longer prohibit app developers from directing users to payment options outside its App Store, a judge ruled on Friday. The decision, which followed a contentious court battle with the maker of the hugely popular Fortnite video game, is a major blow to Apple — but the company also scored a partial victory as the judge stopped short of calling it a monopoly.

Judge Yvonne Gonzalez Rogers of the US District Court in the Northern District of California ruled on Friday thathad violated California's Unfair Competition Law by forcing Fortnite and its maker Epic Games to use Apple's payment systems on the App Store, with the iPhone maker extracting a 30% commission on every in-app purchase in the process. She issued an injunction saying Apple can no longer prohibit developers from adding links within their apps to outside payment options; for example, alerting users to the option to pay for a subscription on a web browser, rather than through the app.

But Gonzalez Rogers sided with Apple on the suit's other claims and said she could not conclude that the iPhone maker is a monopoly.

"Given the trial record, the Court cannot ultimately conclude that Apple is a monopolist under either federal or state antitrust laws," court documents read. "Success is not illegal. The final trial record did not include evidence of other critical factors, such as barriers to entry and conduct decreasing output or decreasing innovation in the relevant market."

The decision, which is almost certain to be appealed, came after a months-long legal fight that could change how we use our smartphones.

Apple's stock was down nearly 3% in midday trading Friday following the decision. In a statement, and a followup press call, Apple framed the decision as a victory for the company and stressed that the court found it was not a monopolist.

"Today the Court has affirmed what we've known all along: the App Store is not in violation of antitrust law," Apple said in a statement. "Apple faces rigorous competition in every segment in which we do business, and we believe customers and developers choose us because our products and services are the best in the world."

In a series of tweets, Epic Games founder and CEO Tim Sweeney said the company " will fight on ."

"Today's ruling isn't a win for developers or for consumers. Epic is fighting for fair competition among in-app payment methods and app stores for a billion consumers," Sweeney tweeted continuing : "Fortnite will return to the iOS App Store when and where Epic can offer in-app payment in fair competition with Apple in-app payment, passing along the savings to consumers."

A spokesperson for Epic confirmed the company plans to appeal the decision.

The fight began last August when Apple kicked Fortnite off the App Store for flouting its rules on in-app payments on the iPhone.

In a software update to Fortnite, Epic encouraged iOS players to buy the game's digital currency, known as V-Bucks, directly from Epic, as opposed to through Apple's in-app purchase system. To sweeten the deal, Epic offered a discount to those who bought V-Bucks directly.

While consumers may have viewed it as a loyalty bonus, Apple saw it as a gross violation of its contract with Epic and an attempt to undercut a key revenue stream. The iPhone maker booted Fortnite from the App store, and Epic immediately filed what appeared to be a largely premeditated lawsuit.

In a contentious trial that began in May and lasted nearly a month, Epic argued that the App Store constituted a monopoly because it is the only way to access hundreds of millions of iPhone users, and that Apple harmed competition by prohibiting other app stores or payment methods on its devices.

The gaming company stressed that it is not seeking any monetary compensation from the lawsuit but wants the judge to compel Apple to relax some of those restrictions. "Epic is solely seeking changes to Apple's future behavior," the company's CEO, Tim Sweeney, said on the stand.

Apple and its CEO Tim Cook sought to undercut that argument by pointing out that the iPhone is one of several devices where Fortnite users can play the game and buy V-bucks, including Android smartphones (Epic is fighting a similar lawsuit against Google) and video game consoles such as the PlayStation and Xbox, many of which also don't allow alternative payment methods and charge similar commissions.

It's not illegal to have a monopoly under US law; it's only illegal to try to preserve a monopoly at the expense of competition.

Apple also justified its 30% commission by saying the earnings from in-app payments help improve security and privacy for the iPhone users that give developers a massive captive audience.

"We've made a choice," Cook told the judge. "There are clearly other ways to monetize, but we chose this one because this one overall is the best way."

Apple's commissions on in-app payments — often referred to by developers as the "Apple Tax" — have been under fire from developers, lawmakers, and regulators around the world for years. And while the Epic lawsuit is one of the more high-profile legal challenges, it is one of many just within the past year alone. Music streaming service Spotify and dating app Tinder's parent company Match Group have been other notable antagonists, with the former taking on Apple both in the United States and Europe over alleged anticompetitive behavior. In the weeks leading up to the verdict, Apple made multiple tweaks to App Store policies in a possible attempt to head off further criticism about its practices. In late August, the company announced a settlement in a class action lawsuit that allows app developers to email their users about alternative payment methods.

Just days later, the company said it will further relax restrictions on "reader" apps — a designation that applies to companies like Spotify and Netflix that distribute media — and allow those apps to link out to external websites for users to set up and manage accounts. That update, which will take effect in 2022, was in response to an investigation by Japan's Fair Trade Commission.

Those changes have received a skeptical reception from the major developers taking on Apple.

"This is a raw demonstration of their monopolistic power: making capricious changes designed to spur good PR for their benefit right as legislation, regulatory scrutiny and developer complaints are closing in on them," a Match Group spokesperson said in response to Apple's class action settlement relaxing email rules for developers. "We hope everyone sees this for what it is — a sham."

Gonzalez Rogers on Friday ordered Apple to change that system, saying the company can no longer prohibit developers from directing users to outside payment mechanisms.

The practical outcome of the 180-page order will likely be that Apple app store developers are no longer required to use Apple's in-app payment system in order to collect funds from iOS users, said Josh Davis, a professor at the University of California at San Francisco law school. He added that Apple will have to be careful with how it implements the order to avoid being in contempt of court after the injunction goes into effect in 90 days.

"They're not just free to characterize this order however they want," he said.

Still, Stanford Law Professor Mark Lemley said it's possible only a few large, well-known apps may benefit from no longer having to rely on Apple's in-app payment system.

"For your ordinary app I'm using, I'm never leaving the app, I'm just using it on the phone," he said. "But it does open the possibility for those that either can persuade you to go or for which you already are going to go [to another platform] ... they can say, 'Hey, go buy your [Fortnite] downloads or your emotes through [the Epic Store].'"

Gonzalez Rogers also ruled in Apple's favor on a counterclaim that Epic was in breach of contract for subverting Apple's in-app payment system and ordered the developer to pay damages equal to 30% of the $12,167,719 in revenue it collected from the iOS Fornite app between August and October 2020, plus 30% of any revenue it earned from the app from November 2020 through the date of the judgment, and interest.

Meanwhile, the pressure on Apple keeps piling up, with the company still facing antitrust scrutiny by the US House and Senate, as well as regulators in the United Kingdom and Europe.

South Korea has already taken one of the most severe actions against Apple's in-app payment restrictions, passing a law in early September that requires Apple and Google to offer alternative payment systems to their users in the country.

Gonzalez Rogers' ruling that Apple has not violated federal antitrust law could increase pressure on US lawmakers to advance proposed bills that would reform antitrust laws for tech giants.

"I would imagine this opinion could add to the momentum behind those bills," UCSF's Davis said, "to the extent that I could imagine legislators saying, 'Wait, we all know Apple has market power. These technicalities of antitrust doctrine are kind of getting in the way. We need to reform the law.'"

Friday's decision is expected to be appealed, and the case could drag on for several months or even years.

Update: This article and headline have been updated to better clarify how Apple has been ordered to ease restrictions on developers.