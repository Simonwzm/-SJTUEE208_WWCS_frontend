CNN —

Apple (AAPL) CEO Tim Cook has spent years building up reserves of goodwill with the White House — meeting President Donald Trump for dinners, showing him around a Texas factory and appearing alongside Ivanka Trump to promote an education initiative.

But that doesn’t mean he’s immune from a little presidential pique now and then, revealing the limits of currying favor with a mercurial President.

This week, Trump injected himself into a fight between the Justice Department and Apple. The company had rejected calls to break the security protections on iPhones used by the gunman who killed three people on a US naval base in Pensacola, Fla. That didn’t suit Trump, who slammed the tech giant in a tweet on Tuesday.

“We are helping Apple all of the time on TRADE and so many other issues,” Trump tweeted, “and yet they refuse to unlock phones used by killers, drug dealers and other violent criminal elements. They will have to step up to the plate and help our great Country, NOW!”

The sudden rebuke from the president is a cautionary note not just for Apple, but arguably for any business leader looking to maintain a beneficial relationship with Trump. Cook is not only one of the world’s most influential CEOs, but has widely been described as having succeeded in building strong ties to the president. Trump himself has praised Cook as being a “great executive because he calls me, and others don’t.”

But the clash this week is a reminder that even Cook and his company can be impacted by Trump’s transactional view of relationships – and how easily the president recasts them to seek more value.

“It doesn’t matter what you’ve done in the past,” said one tech industry lobbyist, reflecting on Trump’s tactics. “It’s what he wants from you today. Trump appears to be moving the goalposts.”

Apple CEO Tim Cook has spent years cultivating a relationship with President Donald Trump. Now it may face a test over a renewed fight over encryption. Nicholas Kamm/AFP/Getty Images

When Trump toured Apple’s Austin plant in November of last year, the company had been staring down the risk of new tariffs on iPhones, MacBooks and other gadgets imported from China. But, Trump said, because of Cook’s investments in the US, the administration would hold off on drawing Apple products into the trade war.

“Because when you build in the United States,” Trump said, “you don’t have to worry about tariffs.”

Cook was soon hailed as political genius. CNBC called him “Teflon Tim,” saying after the Austin visit his “game with Trump worked like a charm.” Sure enough, the threat of iPhone tariffs was ultimately dropped.

This week, however, Apple’s investments were virtually forgotten as Trump appeared to call on Apple to pay for the withheld tariffs by helping his Justice Department with the Pensacola case. The terms of the deal had apparently changed.

It’s unclear if Trump’s tweet will have a lasting impact; on Wall Street, at least, Apple’s stock dipped barely two-tenths of a percent after the tweet before it rebounded and ended higher on the day.

Nevertheless, Trump’s outburst draws focus to a long-simmering, high-stakes standoff between law enforcement and the tech industry that’s threatening to boil over yet again.

Apple previously refused to help law enforcement unlock an iPhone involved in the San Bernardino shooting that took place in late 2015. After a contentious legal battle with Apple, investigators were able to break into the encrypted phone without the company’s help.

In the years since then, Apple – along with others in the tech industry – has doubled down on describing encryption as key to protecting user privacy.

Apple has steadfastly declined to build special “backdoors” for law enforcement to circumvent encryption, arguing those same vulnerabilities would quickly be abused by criminals. Encryption technology is commonly used to secure not only iPhones, but corporate networks, email, messaging apps, financial services and government agencies.

But tensions with law enforcement over encryption were renewed recently amid the DOJ’s criticism that Apple hasn’t helped enough in the investigation of last month’s deadly shooting at a US naval base in Florida.

Two iPhones used by the shooter were recovered from the scene, but law enforcement officials have had difficulty cracking the security encryption on those devices, said Attorney General William Barr. Trump’s tweet slamming Apple on Tuesday put an even greater spotlight on the encryption issue.

“We feel strongly encryption is vital to protecting our country and our users’ data,” Apple said in a statement provided to CNN earlier this week.

Trump’s involvement in the issue foreshadows a bigger confrontation with the DOJ. Apple could seek help from tech-aligned allies within the White House who could marshal opposition to law enforcement, according to a former Trump administration official. Those could include officials at the Office of Science and Technology Policy, or perhaps the National Economic Council, who have worked closely with Apple in the past.

But that may not be enough if Cook and Apple no longer have Trump on their side.