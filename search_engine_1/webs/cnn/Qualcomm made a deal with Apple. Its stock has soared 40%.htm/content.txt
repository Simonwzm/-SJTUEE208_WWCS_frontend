New York CNN Business —

Qualcomm bet it all on its bitter dispute with Apple and won. Now, after the fight was officially ended, its stock is soaring.

With the company no longer at risk of losing one of its most important sources of revenue, Qualcomm’s stock has soared 40% to a 5-year high since it announced Tuesday it had settled all litigation with Apple. Qualcomm will continue charging Apple royalties for its patents, and Apple will pay Qualcomm a substantial fee as part of the agreement.

“This was a major win for Qualcomm,” said Dan Ives, analyst at Wedbush. “The soap opera is finally over.”

The victory was far from certain — the settlement shocked Wall Street. Qualcomm risked everything to achieve it.

Decades ago, Qualcomm patented a method for cell phones to communicate with towers. It used to make cell phones, but now it licenses those patents to smartphone manufacturers. Those licensing fees make up a substantial portion of Qualcomm’s revenue.

Once a household name, Qualcomm (QCOM) remains a crucial player in wireless communications. It makes radios that allow phones to make calls and access the Internet. It also makes mobile central processing units that are the brains for most Android phones. (Apple designs its own.)

Qualcomm chips are a major presence in cell phones Simon Dawson/Bloomberg via Getty Images

The company’s status as a mobile communications leader was under threat after it began squabbling with Apple, one of its biggest and most important customers and also a key to its future because the iPhone was a big part of Qualcomm’s 5G ambitions.

The epic legal battle started in January 2017 when Apple sued Qualcomm for nearly $1 billion. Apple accused Qualcomm of charging “excessive royalties” and withholding payments in retaliation for Apple cooperating with a South Korean investigation into the chipmaker.

Qualcomm retaliated by suing Apple (AAPL) for violating its patents. If it lost its court battles, Qualcomm would have given up a giant source of revenue, and it could have been on the hook for as much as $27 billion in damages for overpaid royalty fees.

It also could have opened the door to rivals in a market Qualcomm dominates. Perhaps coincidentally, Intel (INTC) announced hours after the settlement became public that it was abandoning its plans to make 5G smartphone radios. Intel (INTC) was rumored to be a potential partner for Apple if it stopped buying Qualcomm’s technology.

Investors sent Qualcomm’s stock down 25% when the legal fight began, and the stock remained in the toilet throughout much of last year.

“With a settlement there is no more uncertainty abound for either company and thus removes an overhang that has long weighed on both companies,” Ives said.