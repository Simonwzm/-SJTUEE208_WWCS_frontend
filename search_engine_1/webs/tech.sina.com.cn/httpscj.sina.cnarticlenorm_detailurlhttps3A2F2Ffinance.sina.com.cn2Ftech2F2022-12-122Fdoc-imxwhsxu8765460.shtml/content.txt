　　本文来自微信公众号：无线深海　　在 5G时代，手机套餐中所含的流量越来越多，单位价格也越来越便宜，即便如此，也难以毫无顾忌地刷剧。　　家庭宽带，按带宽收费，流量不限，通过无线路由器将其转化为 Wi-Fi 信号，不但可供全家共享，连接各种智能家居也不在话下。　　无线路由器　　因此，将无线路由器称为家庭的数据枢纽也毫不为过。　　无线路由器这个名称可以拆出来两个关键词：无线和路由。理解了这两个词背后的技术原理，就理解了无线路由器。　　无线也就是我们常说的 Wi-Fi。无线路由器可以将家庭宽带从有线转换为无线信号，所有设备只要连接自家 Wi-Fi，就能愉快地上网了。除此之外，这些设备还组成了一个无线局域网，本地数据高速交换，不受家庭宽带的带宽约束。　　举个例子，很多人家里都有智能音箱，可以用来控制各种智能电器。当你说小 X 小 X，打开电视时，音箱实际上是通过局域网找到电视并发送指令的，并不需要连接互联网；而你如果让它播放新闻时，就必须要通过互联网来获取数据了。　　我们前面说到的局域网，也被称为内网，在路由器上用 LAN （Local Area Network） 来表示，因此 Wi-Fi 信号也被称作 WLAN （Wireless LAN，无线局域网）；而我们要访问的互联网，也被称作外网，在路由器上用 WAN （Wide Area Network） 来表示。　　无线路由器接口示意　　在内网中，每个设备的 IP 地址是不同的，这被称作私有地址；而所有设备上外网则共用同一个公有地址，由电信联通这样的宽带运营商分配。　　路由器，正是连接内网和外网的桥梁。上面说到的 IP 地址转换，数据包转发，就是路由器的路由功能。　　也就是说，路由器是家庭网络的枢纽，所有的设备的数据都必须经过它的转发才能彼此访问或者到达外部网络，颇有一夫当关，万夫莫开的意思，因此功能全面的路由器又被称作“家庭网关”。　　无线路由器组网示意　　无线路由器的无线接入功能，就是之前说过的无线局域网（WLAN）。目前 WLAN 只有 Wi-Fi 这一种主流技术，因此可以认为两者是等同的。　　Wi-Fi 由 Wi-Fi 联盟进行技术认证和商标授权。实际应用中 Wi-Fi 经常被写作 WiFi 或者 Wifi，但这两种写法并没有被联盟认可。　　Wi-Fi 联盟（全称：国际 Wi-Fi 联盟组织，英语：Wi-Fi Alliance，简称 WFA），是一个 商业联盟 ，拥有 Wi-Fi 的商标。。 它负责 Wi-Fi 认证与商标授权的工作，总部位于美国德克萨斯州 奥斯汀 （Austin）。　　Wi-Fi 这个朗朗上口的名字被广泛认为是对无线高保真（Wireless Fidelity）的缩写，实际上是误读。它只是个单纯的名称，并没有实际含义，当然也没有全称。　　Wi-Fi 背后的技术标准，则是由美国的电气电子工程师协会（IEEE）制定的 802.11 系列协议。　　IEEE 全称：Institute of Electrical and Electronics Enginees　　从 1997 年的第一个版本开始，802.11 系列协议不断向前演进，经历了 802.11a / b / g / n / ac 等多个版本，支持的上网速率也不断提升。目前最新的协议版本是 802.11ax，也就是近年来迅速发展的 Wi-Fi 6。　　IEEE 802.11 系列标准的发展历程，从第一代到第六代　　在最初的很多年里，Wi-Fi 虽然一代代向前发展，但世界上并没有 Wi-Fi 几代这样的说法，直接就用 802.11 后面加几个字母这样的协议编号，对普通用户非常不友好。　　直到 2018 年，Wi-Fi 联盟才决定把下一代技术标准 802.11ax 用更为简单易懂的 Wi-Fi 6 来宣传，上一代的 802.11ac 和 802.11n 就顺理成章地成了 Wi-Fi5 和 Wi-Fi4。至于更早的技术，反正也没人关注了，也就不用再起马甲了。　　Wi-Fi 6 诞生之后，才有了 Wi-Fi 5 的叫法　　2019 年 9 月 16 日，Wi-Fi 联盟宣布启动 Wi-Fi 6 认证计划。此后，Wi-Fi 6 的大名响彻了全世界，目前新发布的设备基本都已经支持 Wi-Fi 6 了。　　Wi-Fi 6 认证标志　　Wi-Fi 主要工作在 2.4GHz 和 5GHz 这两个频段上。这两个频段被称作 ISM（Industrial Scientific Medical 工业，科学，医学）频段，只要发射功率满足国家标准要求，就可以不用授权直接使用。　　不同国家的 ISM 频段有所不同　　2.4GHz 作为全球最早启用的 ISM 频段，频谱范围是 2.40GHz~2.4835GHz，共 83.5M 带宽。　　我们常用的蓝牙，ZigBee，无线 USB 也工作在 2.4GHz 频段。此外，微波炉和无绳电话使用的频段也是 2.4GHz。甚至，有线 USB 接口的内部芯片在工作时，也会发射 2.4GHz 的无用信号，造成干扰。　　由此可见，2.4GHz 上同时工作的设备众多，频段拥挤不堪，干扰严重。当万家灯火，你和楼上楼下的邻居在用 Wi-Fi 愉快上网的时候，路由器却在背后默默地挑选信道，协调干扰。　　Wi-Fi 把 2.4G频段上的 83.5M 带宽划分为 13 个信道，每 20M 一个。注意这些信道是交叠的，本来只能放下 3 个，现在却硬生生地挤进去了 13 个，相互之间的干扰难以避免，只能尽量减轻，大不了大家速度慢一些，排队轮着用。　　2.4G 频谱及信道（第 14 信道在国内是不允许使用的）　　信道交叠到什么程度呢？由下图可以比较直观地看出，在这些信道里面，只有 1，6，11 或者 2，7，12，或者 3，8，13 这三组是完全没有交叠的，可见 2.4GHz 频段的拥堵程度。就好比一条很窄的路，上面通行的车却很多，堵车频频，势必造成通行速度的下降。　　2.4G 不交叠的信道分布　　到了 802.11n，用户可以使用 40M 的信道，但 2.4GHz 频段依然只有 83.5M 的总带宽，就只能容纳两个信道了。因此只有在夜深人静网络空闲的时候，单个用户才有可能使用 40M 信道，加之来自隔壁老王家的干扰，802.11n 的高速率很大程度上难以达到。　　2.4G 40M 带宽信道　　如果说 2.4GHz 频段是羊肠小道的话，5GHz 频段无疑就是康庄大道了。　　5GHz 频段的可用范围是 4.910GHz~5.875GHz，有 900 多 M 的带宽，是 2.4G 的 10 倍还多！这段频谱过于宽了，不同国家根据自身情况，定义了 Wi-Fi 可以使用的范围。　　比如，在中国 5GHz 频谱共有 13 个 20M 信道可用作 Wi-Fi，连续的 20M 信道还可以组成 40M，80M，甚至 160M 信道。　　中国 5G 信道分布图　　5GHz 的带宽大，上面跑的的设备少，用起来自然速度快，干扰小。因此，如果想要家庭网络达到良好的速率体验，可用考虑用 5GHz 来进行全屋覆盖。　　然而尺有所短，寸有所长，5GHz 虽然带宽大干扰小，但是信号传播衰减快，还很容易被阻挡，穿墙能力很弱。　　2.4G 和 5G Wi-Fi 信号的穿透损耗　　因此，跟 2.4GHz 相比，5GHz 信号通常要弱得多。至于它们到底各能覆盖多少米，这个由于路由器的天线增益，接收灵敏度，家里墙体和障碍物的分布，以及个人期望达到的上网速率都有关联，很难具体给出。　　如果仅考虑到家里的各种智能家居的联网，2.4GHz 的覆盖和容量通常就够用了。但如果需要高速上网，最大化发挥家庭宽带的价值，就必须依靠 5GHz 才能实现。　　因此，Wi-Fi 的覆盖建议不用考虑 2.4GHz，直接以 5GHz 全屋覆盖作为设计目标。一般情况下单个路由器在家庭的复杂环境下难以实现无死角覆盖，需要考虑多台路由器之间的组网以及漫游问题，这点后面再讲。　　为什么 Wi-Fi 的速度越来越快？其实在 IEEE 的 802.11 系列协议一直在跟 3GPP 的 4G和 5G相互借鉴，使用的底层技术都是通用的。　　OFDM 的全称是正交频分复用。系统会在频域上把载波带宽分割为多个相互正交的子载波，相当于把一条大路划分成了并行多个车道，通行效率自然就大幅提升了。　　在 Wi-Fi 5 及以前（802.11a / b / g / n / ac），子载波宽度是 312.5KHz，到了 Wi-Fi 6（802.11ax），子载波宽度缩小为 78.125KHz，相当于将同样宽度的路划分成了更多的车道。　　Wi-Fi 6 的拥有更多的子载波　　在 OFDM 下，每个用户必须同时占用全带宽下的所有子载波。如果某个需要发送的数据没那么多，把频率资源用不满的话，其他用户也没法灵活使用，只能干巴巴地排队等着，频谱资源的使用效率不高。　　为了解决这个问题，Wi-Fi 6 引入了 OFDMA 技术，后面多了个字母 A，其全称也就变成了正交频分复用多址。多址就是多用户复用的意思。　　OFDM vs。 OFDMA　　OFDMA 可以支持多个用户在同一时刻共享所有子载波。相当于运输公司把多个用户的数据统一打包，共同装车，充分利用车厢容量，大家的发货速度就都加快了，频谱效率得以提升。　　路由器上面的天线数量是越来越多，从看不到天线，到一根，两根，三根，四根，六根，八根。。。 现在不管啥价钱的路由器，都长得跟螃蟹似的，张牙舞爪好不唬人。　　为啥要用这么多天线？就是为了更好地实现 MIMO（多输入多输出）技术。简单来说，就是在信号发射时，用多根天线来同时发送多路不同的数据，速度自然成倍提升；在接收时，多个天线同时接收手机发来的信号，跟戴了助听器一样，接收灵敏度也得到了增强。　　单用户 MIMO（SU-MIMO）　　如果所有天线同时只为一个用户服务，就叫做单用户 MIMO（SU-MIMO）。更进一步，路由器四路发射，手机四路接收，也可以更精细地叫做 4x4 MIMO。　　有时候，路由器的天线众多能力强悍，但四顾茫然，发现手机个个都是弱鸡。路由器能发 4 路信号，但手机最多只能收两路，最终下来路由器也就不得不配合着只发两路。这不是浪费么？　　多用户 MIMO（MU-MIMO）　　解决办法也是有的，一个手机的接收天线少，多个手机加起来不就多了？于是，路由器便将多个手机一起考虑，视作一个功能强大的虚拟手机，这样就又能实现高阶 MIMO 了。这种多手机共同参与的 MIMO 就叫做多用户 MIMO（MU-MIMO），又叫虚拟 MIMO。　　除此之外，多个天线还可以通过波束赋形技术，形成指向性的窄波束，对准用户精准覆盖。由于窄波束的能量集中，因此可以覆盖得更远，穿墙效果也能得以提升。　　波束赋形　　这样看来，路由器的天线个数是多多益善呀，买路由器就一定要挑天线多的吗？这可能是一个陷阱。天线再多，只是在堆一些外部看得见的硬件而已，看起来牛逼闪闪，但内部的设计到底能否支撑这么多天线还是未知数。　　更重要的是，不论是 MIMO，还是波束赋形，都是需要软件算法支撑的，这里面的复杂度远高于硬件，不同厂家算法优化能力不同，可能导致很大的性能差异。　　因此，建议在购买路由器时，不用太关注外部到底能看到多少根天线，而要看他们的产品宣传，是否支持波束赋形，4x4 MIMO，或者 MU-MIMO？如果厂家在这方面的宣传声势很大，那至少说明他们对这些功能比较自信并将其作为卖点。　　调制编码，分为调制和编码两部分，它们共同决定了单位时间可以同时发送的比特数。调制编码策略一般将调制和编码两部分综合起来分为多个等级，级别越高，数据发送的速率也就越快。　　调制的作用就是把经过编码的数据（一串 0 和 1 的随机组合）映射到前面所说帧结构的最小单元：OFDM 符号上。经过调制的信号才能最终发射出去。　　BPSK，QPSK，16QAM，64QAM 及 256QAM 星座图　　常用的调制方式包括 BPSK、QPSK、16QAM，64QAM 和 256QAM，能同时发送的比特数为 1 个，2 个，4 个，6 个和 8 个。Wi-Fi 6 可以支持 1024QAM，可同时发送 10 个比特的数据，速率自然大为提升。　　256QAM 和 1024QAM 对比图　　可是，原始数据在编码时，为了纠错而加入了很多的冗余比特，真正的有用数据其实只占一部分。我们考虑上网速率时，说的仅仅是有用数据的收发速率，冗余比特都在解码的时候丢弃掉了。　　这就要引入码率的概念，也即是有用的数据在编码后总数据量中的占比。如果码率是 3/4，就是指编码后的数据中，3/4 是有用数据，1/4 是后来添加的冗余比特。　　不同的调制方式，加上不同的码率，就组成了调制编码策略（MCS）。下表是 Wi-Fi 6 中的 MCS 表，可以看出最高阶 MCS 为 11，对应于 1024QAM 加 5/6 的码率。　　Wi-Fi 6 的 MCS 表　　正是通过这些技术的不断演进，Wi-Fi 标准一代代向前，速率越来越高，让我们更为畅快地上网。　　Wi-Fi 到底能达到多大速率呢？　　路由器厂家宣传的 Wi-Fi 6 可以达到 1800Mbps，3000Mbps，甚至 5400Mbps 速率，到底是怎么算出来的呢？　　要计算 Wi-Fi 可以达到的峰值速率，必须用到前文讲到的几点技术：OFDM，MCS，以及 MIMO。　　此外，OFDM 技术最终要把数据打包在一个一个的符号（Symbol）中发送，每个符号花的时间越短，两个符号之间的间隔（Guard Interval，GI）越小，速率也就越高。　　综上，单个频段 Wi-Fi 的峰值速率可以用下面的公式来计算。跟 5G 峰值速率的计算类似，上述公式也可以用公路系统来类比。　　Wi-Fi 峰值速率计算公式　　空间流数相当于多层交通，子载波数量相当于每层公路上的多条车道，调制阶数相当于路上货车的车厢容积，码率相当于给货物增加了包装箱，OFDM 符号时长和符号间隔相当于货车在公路的通行时长再加上发车间隔。　　Wi-Fi 速率和公路运力的类比　　如下表所示，IEEE 制定的 802.11ac 最多能支持 8 流，但是 Wi-Fi 联盟（WFA）在认证的时候，觉得这个能力过于强了，实现起来成本太高，因此就分成了两个阶段：wave 1 和 wave 2。　　各 Wi-Fi 协议版本支持的空间流数　　这两个阶段的能力也比较保守，并未最终实现 IEEE 的设计能力。Wave 1 可支持 3 流，Wave 2 可支持 4 流。　　到了 802.11ax，最多可以支持到 8 流。Wi-Fi 联盟将其包装为 Wi-Fi 6，也不再搞过渡版本了。但你的路由器到底能支持到几流，还要看厂家具体的实现。　　如下表所示，802.11n 可支持最大 40M 信道带宽，802.11ac 则能支持 160M 带宽，因此有效子载波数量翻了 4 倍有余。　　各 Wi-Fi 协议版本支持的载波带宽和有效子载波数量　　到了 802.11ax，同样最大支持 160M 信道宽度，但子载波间隔却仅为之前协议的 1/4，从而最大支持的子载波数量相比 802.11ac 又翻了 4 倍。　　各 Wi-Fi 协议版本支持的调制阶数　　802.11ax 则最大支持到 1024QAM，每个符号可同时携带 10 个比特的数据，比前一代提升了 25%。　　各 Wi-Fi 协议版本支持的 MCS　　调制阶数越高，码率越高，抗干扰能力也就越差。因此在无线信号强度足够，且干扰很小的时候，高阶 MCS 才能发挥作用。　　各 Wi-Fi 协议版本支持的符号长度和符号间隔　　到了 802.11ax，符号长度成了 12.8 微秒，间隔长度为至少 0.8 微秒，两者加起来就是 13.6 微秒。　　这个值虽远高于之前的协议，看似吃了亏，但 802.11ax 在其他方面非常优秀，速率还是对前辈形成了碾压之势。　　把上述多个表格中的数据带入公式计算，采用该协议可支持的最高阶调试方式及码率，符号间隔使用最小值，先不考虑空间流数，单流的计算结果见下表。　　各 Wi-Fi 协议版本支持的单流速率　　不同无线路由器 Wi-Fi 峰值速率的支持能力不同，主要体现在 2.4G 和 5G 这两个频段可支持的带宽，以及空间流数。　　2.4GHz 通常最大支持到 40M 带宽，5GHz 频段可最大支持 160M 带宽，再根据协议版本的不同，以及空间流数的不同，把两个频段能支持的峰值速率加起来，就是路由器官方宣传的峰值速率了。　　各型号路由器支持的峰值速率　　上图是蜉蝣君根据路由器的标称速率，来估计 2.4GHz 和 5GHz 这两个频段可支持的信道带宽以及流数，并对速率计算进行了验证。　　话说在远古时代，我出差亚非拉时总是有一种焦虑感，唯恐入住的酒店或者宿舍没有网络或者没有 Wi-Fi，因此必随身携带插线板，网线和一个便携式路由器。近几年发现 Wi-Fi 几乎已经无处不在了，这套装备也逐渐蒙上了厚厚的尘土。　　这个便携路由器，直接插上网线啥都不用管就能用了，家里也曾使用过的多款路由器，大部分也都是直接插上电源，用手机简单配置下就成。至于用的是啥工作模式和组网方案，并没有特殊关注。　　近期，我拿出了尘封已久的便携路由器研究了下，发现事情并没有那么简单。为了达到更好的覆盖效果，路由器之间可以灵活组网，有多种工作模式。了解了这些原理之后，在家庭网络覆盖规划时，就能做到成竹在胸。　　SSID 的全称是 Service Set Identifier，翻译成中文就是服务集标识。这个概念看似高大上，其实就是 Wi-Fi 信号的名称。　　无论在哪里，只要用电脑或者手机一搜，必然能看到一连串的 Wi-Fi SSID 以及它们的信号强度。这些 Wi-Fi 信号可以是加密的，也可以是不加密的。　　电脑搜到的 SSID 列表　　这就是 SSID 的核心功能：将一个无线局域网（WLAN）分为几个需要不同身份验证的子网络，每一个子网络都需要独立的身份验证，防止未被授权的用户进入本网络，一般的家庭组网都会设置密码。　　SSID 名称示意　　一般的双频路由器都可以把 2.4GHz 和 5Hz 这两个频段分为两个 SSID，但这可能会造成困惑，经常出现连接 2.4GHz 频段的 SSID，难以切换到 5GHz 的情况。因此很多路由器也支持双频合一，系统自动设置信号切换门限，用户无感知。　　局域网内的每个手机或者电脑都有一个 IP（Internet Protocol，网络层协议）地址用于相互通信，我们常见的格式（IPv4）由 32 位 0 或者 1 组成。　　32 位二进制 IP 地址的格式大体如下：11000000101010000000000000000001，可是这看起来一点都不直观。　　于是我们把它分为四段：11000000.10101000.00000000.00000001，这还是不够直观。于是我们把它转换为十进制：192.168.0.1，这下终于看着顺眼多了。　　为了方便管理，我们把 IP 地址分为两部分，网络前缀和主机地址。网络前缀标识了一个网络，也称为网段，主机地址用来标识该网络内部的每一台设备。　　IP 地址示意　　如上图所示，该地址前三段的“192.168.0”为网络前缀，最后一段的“123”为主机地址。最后的主机地址中 8 位二进制数字的范围是 0~255，0 和 255 作为特殊用途，实际可用的范围是 1~254。　　子网掩码用一连串的 1 来表示 IP 地址中哪些位是网络前缀。在上图的例子中，IP 地址的前三段 24 位都是网络前缀，掩码标记为 11111111111111111111111100000000（不用数，24 个 1），同样分为 4 段再转换为 10 进制，就是 255.255.255.0，也可以附在 IP 地址的后面，写作 192.168.0.123/24。　　IP 地址和子网掩码设置示意　　同一网段内部的设备可以相互通信，不同处于网段的设备，需要通过路由器的路由功能进行转发才能互通。家庭网络中的设备不多，在组网时建议尽量让所有设备处于同一网段下，方便相互访问。　　网段间通信示意　　上图仅用网线连接的 PC 电脑来作为示例，实际上每个网段都可以通过有线或者无线方式来接入，设备也不限于电脑，手机，音箱，摄像头，门铃等可以联网的设备都是可以的。　　无线路由器的工作模式众多，大体可分为路由模式和 AP 模式。AP 模式又可以细分为 AP 模式（套娃），中继模式，桥接模式及客户端模式。　　基于这些基本的工作模式，多个路由器之间可以形成 AP+AC，以及 Mesh 这两种组网方式，达到无缝覆盖，自动漫游的效果。　　路由器的工作模式和组网示意　　绝大多数无线路由器都工作在这种模式之下，同时使用了路由器的无线接入功能和路由功能。　　最常见的用法是，路由器 WAN 口连接入户光猫，并设置 PPPoE 拨号上网并提供各种路由及安全防护功能。为了熊孩子的未来，上面还可以配置多种上网管控策略，如 IP 地址，网址，应用访问的约束等。　　对应地，路由器的无线接入功能则负责发射 Wi-Fi 信号组成无线局域网 WLAN，进行全屋无线信号覆盖。接入 WLAN 和连接有线 LAN 口的多个设备位于同一个局域网内，拥有相同的网段，可以直接进行内网通信。　　路由模式示意　　此外，还可以把路由器用 WAN 口和上级路由器的 LAN 口连接起来，形成二级路由，就可以配置两个网段的内网，以及两个不同的 Wi-Fi 名称（配成一样的也行）。　　这种组网无法实现两个路由器之间的无缝漫游，一个 Wi-Fi 信号减弱并切换到另一个过程伴随 IP 地址的变化，网络中断感觉明显。　　AP 就是指接入点（Access Point）。顾名思义，工作在这种模式下的路由器只有接入功能，并没有用到路由功能，因此就不提路由二字了，直接叫做接入点。　　接入点没有路由功能，并不代表路由功能就不存在，只是由另一台路由器来承担了而已。也就是说，AP 模式下的路由器无法独立完成上网重任，需要跟另外一台路由器协作，多用于覆盖的扩展。　　AP 模式有 3 个子模式：AP 模式（套娃），中继模式，桥接模式。　　启用 AP 模式的路由器通过网线和上级路由器连接，仅有接入功能作为无线覆盖扩展（用作主力覆盖也可以），路由和 DHCP 等功能由上级路由器完成。因此接入 AP 的手机或者电脑和上级路由器处于同一网段，可直接互通。　　AP 的无线网络名称（SSID）和密码可以独立设置，跟上级路由器的相同或者不同都行。如果 Wi-Fi 名称的设置不同，两个设备之间肯定是没法无缝漫游的，只能是一个信号太弱断开之后再连另一个，或者手动连接。　　就算把这些 AP 设置为相同的 SSID，看似家里只有一个 Wi-Fi 信号，但实际上 AP 和主路由的无线信号缺乏交互，配置和管理比较麻烦，也是无法实现无缝漫游的。　　AP 模式示意　　这种组网下的 AP 功能完善，每个节点都要分别配置，相互独立工作，因此叫做“胖 AP（Fat AP）”。　　胖 AP 们虎踞龙盘，没有统一的管理，各自的覆盖之间也无法漫游，在家里数量少了还能凑合用，在商场，机场这些超大空间，需要的 AP 数量极其庞大，就只能另请高明了。　　既然胖 AP 不好管理，我们可以把它再进行拆分，只保留最基本的接入功能，将配置管理功能独立出来，组建为一个全新的设备：接入控制器（Access Controller，AC），普遍简称作 AC。　　AP+AC 组网示意　　AC 负责管理所有的 AP，只要在 AC 上进行统一配置，就可以自动同步到所有的 AP 节点，并且所有 AP 的工作状态都可以在 AC 上进行实时监控，维护起来也非常方便。这种状态的 AP 只需要好好干活就行，其他啥都不用管，当然也就没啥花花肠子了，因此叫做“瘦 AP（Fit AP）”。　　更重要的是，通过让 AP 们支持 802.11k / v / r 协议，就可以实现 AP 间的无缝漫游了。　　802.11k：无线资源测量协议，可帮助终端快速搜索附近可作为漫游目标的 AP。　　802.11v：无线网络管理协议，用来解决 AP 之间的负荷均衡，以及终端节电等功能。　　802.11r：快速漫游协议，用于加速手机或者电脑在漫游时的认证流程。　　上述漫游协议需要路由器和手机同时支持才能正常工作。　　在各厂家的实际 AP 产品中，大多支持 802.11k / v 协议，对于家庭网络已经足够用了。　　这个方案简直完美啊，还有没有改进空间呢？　　我们考虑下，大量的 AP 要跟 AC 连接，除了要提前铺设大量的网线之外，还要准备对应的电源给 AP 供电，这工作量就大了去了。网线本身也是电线么，AP 的功耗一般也不高，网线能不能在传数据的同时也把供电的活给干了呢？　　还真可以。这种供电方式有专门的协议，叫做 PoE（Power over Ethernet，以太网供电），需要交换机等连接设备和 AP 双方都支持才能正常供电。　　AP+AC+PoE 供电组网示意　　这样一来，我们在 AC 的后面再接上一个 PoE 交换机，再把所有等 AP 换成可以支持 PoE 的型号，就可以实现 PoE 供电了，省去了多处拉电源线的烦恼，顿时感觉网络清爽了许多。　　然而有人可能要说了，我家就 2 个房间再加 1 个客厅，一共 3 个 AP 就够了，结果不但要搭上接入主路由器，AC，再来个 PoE 交换机，不但成本高，连弱电箱都没空间放了！　　确实如此，AC+AP 方案主要用于大面积的商业场所，再不济也是别墅这种多层楼且房间多的情况，对于普通住宅有些杀鸡焉用宰牛刀的意思，确实不大合适。　　路由 / AC / PoE 一体机 + AP 组网示意　　不过商家也针对性地开发了精简的方案，把路由器，AC 和 PoE 交换机合而为一，称之为“路由 / AC / PoE 一体机”，跟普通的家用交换机大小仿佛，成本也大幅降低。　　与此同时，上述方案也将 AP 也集成在传统的 86 型网线插座面板内，完全隐藏于无形，却达成了 Wi-Fi 无缝覆盖，信号强劲的最佳状态。　　面板式 AP 组网示意图　　AC+AP 的优点显著，但也有缺点。那就是所有的 AP 都需要使用网线和 AC 连接，这就要求在装修时就考虑好 Wi-Fi 组网，并布好网线。如果没有网线可达，就必须考虑其他方案了。　　跟 AP 模式不同，在中继模式下的路由器和上级路由器之间并没有网线连接，只是单纯地接收上级路由器的无线信号，进行放大后再发出去，不做任何处理。　　中继模式组网示意　　因此中继模式下 AP 信号的 Wi-Fi 名称和密码都跟上级路由是一样的，所有的设备也都位于同一网段。对于用户来说，接入中继 AP 和主路由的效果是完全一样的，中继 AP 仅相当于一个扩展覆盖的管道，一切的处理都由主路由进行。　　桥接模式和中继模式比较类似，也是在没有网线的情况下，通过无线来连接两个路由器。两者的差异在于：中继模式工作于物理层，不能做任何设置，而桥接模式则工作于数据链路层，可以配置独立的 SSID。　　桥接模式组网示意　　虽说 SSID 可以不同（也可以配成相同的），但处于桥接模式下的路由器和主路由器的网段是相同的，设备连接之后可以互相访问。　　工作中继或者桥接模式的路由器，必须在主路由的覆盖范围内才能放大信号来进行上网。如果在主路由的信号很差的位置，放大之后虽然手机看到的 Wi-Fi 信号是满格的，但是网速依然很慢甚至可能很不稳定。　　并且，主路由是不知道下级中继或者桥接节点的存在的，它们之间也不存在管理和交互的关系，没法进行漫游，只能等待信号过差断开之后手机再重新连接另一个节点。　　有没有方法能综合 AC+AP 这样的有线组网，以及中继或者桥接这样的无线组网，并能智能管理这个网络，实现简化配置，无缝漫游的效果呢？　　这就要用到 Mesh 组网技术了。　　Mesh 又叫多跳网络，由多个地位相同的节点通过有线或者无线的方式相互连接，组成多条路径，最终连接到跟互联网相连网关。这样的网络存在一个控制节点来对所有节点进行管理和配置数据下发。　　下图是一个实际组网的案例，由主路由作为网关和控制节点，其余节点通过有线或者无线连到主路由，或者通过无线来相互连接。这样一来，弱覆盖的区域不论有没有网线，网络都可以灵活地按需扩展。　　Mesh 组网示意　　路由器之间的有线连接叫做“有线回程”，对应地，无线连接就叫做“无线回程”。　　Mesh 组网非常适合于家庭 Wi-Fi 覆盖使用。想象一下这样的场景：　　第一步：小明买了套房子，起初只有小两口住，于是就先买了个路由器放在客厅，离得近的主卧也覆盖良好，夫妻俩觉得这就够用了。　　第二步：小孩出生后，老妈和丈母娘也来帮忙照顾，但其他房间的 Wi-Fi 信号不佳，直接再买个路由器，通过有线的方式 Mesh 组网，无缝漫游效果好。　　第三步：大家一致反映卫生间上网困难，那就再买个路由器挂墙上，通过无线的方式和前两个 Mesh 组网，这下大家都很满意，就是如厕的时间变长了。　　虽说这些路由器的型号不同，但只要都支持 Mesh 组网就可以配合使用，不像 AC+AP 那样还要搭上个 AC 和 PoE 交换机，还有网线的约束。最主要的是，普通的家用路由器已经普遍支持了最新的 Wi-Fi 协议，价格还低。　　目前各个厂家对于 Mesh 组网的实现各不相同，起的名字自然也不同。一般情况下，不同厂家的路由器之间是不能组 Mesh 的，这可能会约束路由器的购买选择。　　为了解决不同厂家的路由器的互联互通问题，Wi-Fi 联盟推出了 EasyMesh 技术，可以让不同厂家的路由器之间也支持 Mesh 组网。　　Wi-Fi 联盟的 EasyMesh 组网　　但是厂家都各有自己的算盘，本来用互不兼容的 Mesh 技术就可以圈住用户了，支持了这 EasyMesh 让用户选别家的产品，这明显对自己不利啊。因此 EasyMesh 目前的支持率并不高。　　为了更好地支持 Mesh 组网，让用户获得更高的网速，厂家就专门拿出一个 5GHz 频段来做路由器之间的无线回程，这样路由器就需要同时支持一个 2.4GHz 和两个 5GHz 频段，因此叫做“三频路由器”。　　三频 Mesh 路由器示意　　网上经常有家用组网到底 Mesh 和 AC+AP 哪个方案好的疑问，在此给出蜉蝣君的一些看法。　　首先，无论是 Mesh 组网还是 AC+AP，都可以达到全屋覆盖和无线漫游的效果。Mesh 组网在全部使用有线回程的情况下，基本上等同于 AC+AP。　　Mesh 组网更为灵活，可用无线回程，也可用有线回程，还可以混合使用，而 AC+AP 则只能使用有线连接，需要提前规划布线。　　另外，AC+AP 方案中的 AC 可以置于弱电箱，AP 使用面板式也不占空间，所有设备没有任何的网线和电源线外露，非常清爽美观。而 Mesh 方案则需拖着拉网线和电源线，美观性上要差得多。　　最后，AC+AP 需要购置至少一台路由 / AC / PoE 一体机和两台 AP 才有意义，如果要支持千兆网口和 Wi-Fi6，这些设备都不便宜；而 Mesh 组网则亲民多了，两台路由的价格远低于 AC+AP。　　在选择组网方案时，可以根据上述两方案的特点综合考虑。　　对于无线路由器而言，除了前面几期说到的无线接入功能之外，路由功能也非常关键，它解决的是你怎么上网的问题。　　一般情况下，你在办理家庭宽带时，运营商会为你分配一个账户，具体表现就是一个用户名和密码，这就是你接入互联网的通行证。　　路由器上的 WAN 口用于连接光猫，之后就可以在 WAN 口配置里，选择上网接入方式。绝大多数情况下，需要选择 PPPoE 拨号，再输入用户名和密码之后，运营商会给你分配一个 IP 地址，路由器就成功联网了。　　Wi-Fi 拨号上网示意图　　WAN 口的联网方式还有动态 IP 和静态 IP 这两种方式，不过国内的运营商基本上是不用的。如果家里有两个以上的路由器组成多级路由的话，就需要设置上述两种方式。　　运营商分配只会给你分配一个公网 IP 地址，理论上只允许一个设备上网。但现在家家都有多部手机，多台电脑，以及各种物联网设备需要联网，这可怎么办？　　我们知道，路由器的 LAN 口及 WLAN（Wi-Fi）组成了一个局域网，路由器同样会给接入的每一个设备分配一个不同的 IP 地址。这些 IP 地址一般以 192.168.x.x 开头，他们属于私有地址，只能在局域网内部使用。　　网络地址转换示意图　　这些设备要上网，就必须把私有 IP 转换成对外的公有 IP 才行，这就要用到 NAT 协议。NAT 可以把多个私有地址转换为公有地址，这样一来多个设备就可以共享同一个公有 IP 来上网了。　　安全管理　　路由器作为家庭网关，防火墙的功能一般都是必备的，可抵抗网络攻击。　　防火墙最常见的功能是 DoS（Denial of Service）攻击保护。DoS 攻击，俗称拒绝服务攻击，通过发送大量的无用请求数据包，从而耗尽路由器的 CPU 和内存等资源，导致无法进行正常的服务。　　网络攻击　　除了防火墙之外，安全管理还有很多实用的功能。　　很多人想约束孩子上某些网站，约束使用某些 APP，或者约束上网时间段，都可以通过防火墙功能来实现。　　路由器除了拨号上网和 NAT 之外的其他功能，虽然我们一般情况下用得不多，但对此有个大概了解，说不定哪天就用到了。你说呢？　　到路由器的硬件，很多人可能会说，我就是要买个路由器而已，又不是造个路由器，知道这么多细节又能做啥？　　这种想法，其实。。。。。。 也对。　　路由器其实跟我们常用的电脑或者手机类似，内部也包含了 CPU、内存、硬盘等等对应的配置，这些硬件能力越强，想必路由器的性能也就越强悍。　　但当你在购物网站打开某款路由器的介绍时，会发现大多数厂家的各种牛逼闪闪的亮点宣传，其实都是顾左右而言它，就是不想告诉你这玩意儿内部到底配了啥。反正绝大多数人对此也没有太多要求。　　如果优秀的你想要详细了解一款路由器的肚子里到底有多少货，做工到底扎不扎实，就只能去看拆机视频了。到了这一步，事先了解下路由器的硬件组成和作用就是有必要的了。　　好，那我们这就开始。　　说是 CPU，其实叫做 SoC（System On Chip，片上系统）更为精确，因为一般的处理芯片都集成了 CPU 和很多其他的重要功能，形成了一个片上系统。　　无论是中端还是高端路由器，CPU 都是当仁不让的计算核心，所有的数据转发都会经过 CPU。因此 CPU 决定了路由器的负载能力，能够承受多少的数据吞吐量，其性能、功耗、散热措施等都是非常重要的。　　在低端家用路由器中，CPU 负责路由表查询和数据包转发。在中高端家用路由器中，CPU 主要负责操作系统和其他附加功能的运行，包转发和路由表查询则主要由 ASIC 芯片完成。　　目前常见的家用无线路由器 CPU 厂商主要是这么几个：博通（Broadcom），高通（Qualcomm），MTK（联发科），瑞昱（Realtek）。对于动手能力强，想要刷新第三方固件的用户来说，就需要考虑 CPU 的品牌和型号了，我们通常认为博通 > 高通 > 其它。　　此外集成了 CPU 的 SoC 芯片还决定了对外网口接口的数量，USB 接口类型等等。当然，有些路由器使用外置接口的扩展，而不使用 SoC 集成的配置。　　这里的内存（RAM）和我们通常所说的电脑内存的含义相同，在手机上也叫做运存。　　无线路由器中的内存主要用来储存操作系统指令，动态数据、缓冲报文等数据。通常来说，路由器内存越大越好。路由器厂家的软件算法优化地好的话，可以节省大量内存，硬件使用效率更优。　　相对智能手机动辄 6G 到 8G 的内存来说，路由器的功能比较少，对内存的需求没有那么大。一般来说，千兆路由器使用 128M 内存就够用了，256M 已经属于高配大内存了。　　闪存相当于路由器的硬盘，用来存储路由器的固件，也就是操作系统。一般来说，容量 16M 或者 32M 就够用了，附加功能或者魔改较多的路由器可能要 128M 乃至 256M，如果不太想刷固件折腾的话不用特别关注。　　无线管理芯片　　顾名思义，无线管理芯片是用来支撑路由器的无线功能的。也就是说，路由器支持 Wi-Fi 5 还是 Wi-Fi 6，几个发射天线，MIMO 功能到底如何，都是由无线管理芯片决定。该芯片可以独立部署，也可以集成在 SoC 芯片中。　　功放芯片也就是射频前端模块（FEM），由功率放大器（PA）、滤波器、双工器、射频开关、低噪声放大器（LNA）、接收机和发射机等子模块组成，也都封装在射频芯片中。　　射频前端是无线信号处理距离天线最近的一步，其性能直接和 Wi-Fi 信号的质量和稳定性相关。　　无线管理芯片一般都集成了内置的射频前端，但厂家也可以弃之不用，而使用性能更强的外置独立射频前端。一般认为，每根天线都拥有独立的射频前端时路由器才能达到最佳的无线性能，因此有很多路由器以此作为卖点宣传。　　网口是路由器上所必备的，分为连接光猫或者上级路由器的 WAN 口和具有内部交换功能的 LAN 口。　　绝大多数的家用无线路由器都具备一个 WAN 口和四个 LAN 口，组网一般都是够用的。考虑到目前无线组网已成为绝对的主流，很多路由器已经把 LAN 口减配为一个或者两个，甚至不再从硬件上区分 WAN 口和 LAN 口，而靠软件去自适应识别。　　在 Wi-Fi6 和超过 100M 以上的宽带已普及的时代，网口速率至少需要选择千兆的。当心不要被配备百兆网口的千兆路由器欺骗，这类路由器的价格一般非常低，购买的时候需要注意。　　随着光纤入室（FTTR）技术的发展，家庭全光组网方案也已上市。光纤这种介质能提供几乎不受限的传输容量，有超高带宽需求或者考虑未来带宽升级的同学可以考虑。　　蜉蝣君找到了一张 TP-Link 某款路由器的架构图，我们可以一起来简单看看这款产品（非广告，这玩意普联也不在国内卖）的里面到底配了些啥。　　TP-Link 路由器　　首先，最中间的是高通的 SoC 芯片，内部集成了主频为 700MHz 的 CPU，以及 2.4GHz 频段的无线管理模块，可支持 802.11g（Wi-Fi 3），并连接到了 3 路外置的射频前端模块，也就是说 2.4GHz 支持 3 根天线。　　路由器设计架构图　　从 SoC 的 PCIe 总线延伸出去，可以看到另一块支持 5GHz 频段的无线管理芯片，可支持 802.11ac（Wi-Fi 5），也连接到了 3 路外置的射频前端模块，也就是说 5GHz 也支持 3 根天线。　　由此可以得出，这是一款支持 Wi-Fi 5 的双频路由器，两个频段共配置有 6 根天线，分别都可以支持 3x3MIMO，用料还是不错的。　　可是，路由器的外部仅仅赫然挺立着 3 根天线，剩余的 3 根去了哪里？其实是集成在路由器内部的，人家就是这么低调。　　路由器实物拆解　　由此可见，靠外置天线数量来推测路由器的能力是很不靠谱的，不迷信八爪鱼看似牛逼的外表，具体性能如何还是要看参数，拆硬件。　　好了，关于无线路由器及 Wi-Fi 的介绍就到这里，希望对大家有所帮助。“掌”握科技鲜闻  （微信搜索techsina或扫描左侧二维码关注）新浪科技新浪科技为你带来最新鲜的科技资讯苹果汇苹果汇为你带来最新鲜的苹果产品新闻新浪众测新酷产品第一时间免费试玩新浪探索提供最新的科学家新闻，精彩的震撼图片新浪科技意见反馈留言板Copyright © 1996-2022 SINA Corporation